'use strict';

window.app = angular.module('NBA_Pickem_App', ['preBuilt', 'ui.router']);

app.config(function ($urlRouterProvider, $locationProvider) {
  // This turns off hashbang urls (/#about) and changes it to something normal (/about)
  $locationProvider.html5Mode(true);
  // If we go to a URL that ui-router doesn't have registered, go to the "/" url.
  $urlRouterProvider.otherwise('/login');
  // Trigger page refresh when accessing an OAuth route
  $urlRouterProvider.when('/auth/:provider', function () {
    window.location.reload();
  });
});

// This app.run is for listening to errors broadcasted by ui-router, usually originating from resolves
app.run(function ($rootScope) {
  $rootScope.$on('$stateChangeError', function (event, toState, toParams, fromState, fromParams, thrownError) {
    console.info('The following error was thrown by ui-router while transitioning to state "' + toState.name + '". The origin of this error is probably a resolve function:');
    console.error(thrownError);
  });
});

// This app.run is for controlling access to specific states.
app.run(function ($rootScope, AuthService, $state) {

  // The given state requires an authenticated user.
  var destinationStateRequiresAuth = function destinationStateRequiresAuth(state) {
    return state.data && state.data.authenticate;
  };

  // $stateChangeStart is an event fired
  // whenever the process of changing a state begins.
  $rootScope.$on('$stateChangeStart', function (event, toState, toParams) {

    if (!destinationStateRequiresAuth(toState)) {
      // The destination state does not require authentication
      // Short circuit with return.
      return;
    }

    if (AuthService.isAuthenticated()) {
      // The user is authenticated.
      // Short circuit with return.
      return;
    }

    // Cancel navigating to new state.
    event.preventDefault();

    AuthService.getLoggedInUser().then(function (user) {
      // If a user is retrieved, then renavigate to the destination
      // (the second time, AuthService.isAuthenticated() will work)
      // otherwise, if no user is logged in, go to "login" state.
      if (user) {
        $state.go(toState.name, toParams);
      } else {
        $state.go('login');
      }
    });
  });
});

(function () {

  'use strict';

  // Hope you didn't forget Angular! Duh-doy.

  if (!window.angular) throw new Error('I can\'t find Angular!');

  var app = angular.module('preBuilt', []);

  // app.factory('Socket', function () {
  //     if (!window.io) throw new Error('socket.io not found!');
  //     return window.io(window.location.origin);
  // });

  // AUTH_EVENTS is used throughout our app to
  // broadcast and listen from and to the $rootScope
  // for important events about authentication flow.
  app.constant('AUTH_EVENTS', {
    loginSuccess: 'auth-login-success',
    loginFailed: 'auth-login-failed',
    logoutSuccess: 'auth-logout-success',
    sessionTimeout: 'auth-session-timeout',
    notAuthenticated: 'auth-not-authenticated',
    notAuthorized: 'auth-not-authorized'
  });

  app.factory('AuthInterceptor', function ($rootScope, $q, AUTH_EVENTS) {
    var statusDict = {
      401: AUTH_EVENTS.notAuthenticated,
      403: AUTH_EVENTS.notAuthorized,
      419: AUTH_EVENTS.sessionTimeout,
      440: AUTH_EVENTS.sessionTimeout
    };
    return {
      responseError: function responseError(response) {
        $rootScope.$broadcast(statusDict[response.status], response);
        return $q.reject(response);
      }
    };
  });

  app.config(function ($httpProvider) {
    $httpProvider.interceptors.push(['$injector', function ($injector) {
      return $injector.get('AuthInterceptor');
    }]);
  });

  app.service('AuthService', function ($http, Session, $rootScope, AUTH_EVENTS, $q) {

    function onSuccessfulLogin(response) {
      var user = response.data.user;
      Session.create(user);
      $rootScope.$broadcast(AUTH_EVENTS.loginSuccess);
      return user;
    }

    // Uses the session factory to see if an
    // authenticated user is currently registered.
    this.isAuthenticated = function () {
      return !!Session.user;
    };

    this.getLoggedInUser = function (fromServer) {

      // If an authenticated session exists, we
      // return the user attached to that session
      // with a promise. This ensures that we can
      // always interface with this method asynchronously.

      // Optionally, if true is given as the fromServer parameter,
      // then this cached value will not be used.

      if (this.isAuthenticated() && fromServer !== true) {
        return $q.when(Session.user);
      }

      // Make request GET /session.
      // If it returns a user, call onSuccessfulLogin with the response.
      // If it returns a 401 response, we catch it and instead resolve to null.
      return $http.get('/session').then(onSuccessfulLogin).catch(function () {
        return null;
      });
    };

    this.login = function (credentials) {
      return $http.post('/login', credentials).then(onSuccessfulLogin).catch(function () {
        return $q.reject({ message: 'Invalid login credentials.' });
      });
    };

    this.logout = function () {
      return $http.get('/logout').then(function () {
        Session.destroy();
        $rootScope.$broadcast(AUTH_EVENTS.logoutSuccess);
      });
    };
  });

  app.service('Session', function ($rootScope, AUTH_EVENTS) {

    var self = this;

    $rootScope.$on(AUTH_EVENTS.notAuthenticated, function () {
      self.destroy();
    });

    $rootScope.$on(AUTH_EVENTS.sessionTimeout, function () {
      self.destroy();
    });

    this.user = null;

    this.create = function (user) {
      this.user = user;
    };

    this.destroy = function () {
      this.user = null;
    };
  });
})();

app.directive('navbar', function () {
  return {
    restrict: 'E',
    templateUrl: 'js/directives/navbar/navbar.html'
  };
});

app.directive('tabmenu', function () {
  return {
    restrict: 'E',
    templateUrl: 'js/directives/tabMenu/tabMenu.html'
  };
});

app.factory('CookieFactory', function () {

  var cookieObj = {};

  function isCookie() {
    if (document.cookie) {
      parseUserInfo();
      return true;
    } else {
      return false;
    }
  }

  function setCookie(loginInfo) {
    cookieObj.email = loginInfo.email;
    cookieObj.password = loginInfo.password;
    document.cookie = 'userInfoJSON=' + JSON.stringify(cookieObj);
    resetCookieExpire();
  }

  function resetCookieExpire() {
    var currentDate = new Date();
    var expireDate = new Date(currentDate.setMonth(currentDate.getMonth() + 6));
    document.cookie = 'expires=' + expireDate.toUTCString();
  }

  function getCookie() {
    return cookieObj;
  }

  function parseUserInfo() {
    var parseInfo = document.cookie.split('=');
    var userInfo = parseInfo[1].split(';')[0];
    cookieObj = JSON.parse(userInfo);
  }

  return {
    isCookie: isCookie,
    setCookie: setCookie,
    getCookie: getCookie
  };
});

app.controller('LeagueCtrl', function ($scope, $http, LeagueFactory) {

  $scope.tab = { league: 'active' };

  LeagueFactory.getLeagueTeams().then(function (leagueTeams) {
    $scope.teams = leagueTeams;
  });
});

app.factory('LeagueFactory', function ($http, $stateParams) {

  function getLeagueTeams() {
    return $http.get('/api/league/' + $stateParams.id + '/teams').then(function (response) {
      console.log(response.data);
      return response.data;
    });
  }

  return {
    getLeagueTeams: getLeagueTeams

  };
});

app.config(function ($stateProvider) {
  $stateProvider.state('league', {
    url: '/league/:id',
    templateUrl: 'js/views/league/league.html',
    controller: 'LeagueCtrl'
  });
});

app.config(function ($stateProvider) {

  $stateProvider.state('login', {
    url: '/login',
    templateUrl: 'js/views/login/login.html',
    controller: 'LoginCtrl'
  });
});

app.controller('LoginCtrl', function ($scope, LoginFactory, CookieFactory) {
  $scope.login = {};
  $scope.error = null;
  $scope.isLoginState = function () {
    return true;
  };

  function sendLoginNow(loginInfo) {

    $scope.error = null;

    LoginFactory.sendLogin(loginInfo).catch(function () {
      $scope.error = 'Invalid login credentials.';
    });
  }

  $scope.sendLogin = sendLoginNow;

  if (CookieFactory.isCookie()) {
    sendLoginNow(CookieFactory.getCookie());
  }
});

app.factory('LoginFactory', function (AuthService, $state, UserFactory, CookieFactory) {

  function sendLogin(loginInfo) {
    return AuthService.login(loginInfo).then(function () {
      return CookieFactory.setCookie(loginInfo);
    }).then(function () {
      return UserFactory.initUserFactory();
    }).then(function () {
      $state.go('user');
    });
  }

  return {
    sendLogin: sendLogin
  };
});

app.controller('NBA_Ctrl', function ($scope, NBA_League_Factory) {

  $scope.tab = { nbaStandings: 'active' };

  $scope.nbaTeamsInfo = NBA_League_Factory.getNBATeamInfo;
});

app.factory('NBA_League_Factory', function ($http, $log) {

  var nbaTeamInfo = [];

  // For now just making an IIFE will make more
  // performant later
  (function getNBATeamInfo() {
    return $http.get('api/nba-teams/wins/2016').then(function (response) {
      nbaTeamInfo = response.data;
    }).catch($log);
  })();

  return {
    getNBATeamInfo: function getNBATeamInfo() {
      return nbaTeamInfo;
    }
  };
});

app.config(function ($stateProvider) {
  $stateProvider.state('nbaLeague', {
    url: '/nba-standings',
    templateUrl: 'js/views/nba-league/nba.league.html',
    controller: 'NBA_Ctrl'
  });
});

app.controller('TeamCtrl', function ($scope, TeamFactory) {
  $scope.tab = { team: 'active' };

  TeamFactory.getTeams().then(function (teams) {
    $scope.nbaTeams = teams;
    $scope.teamTotalWins = TeamFactory.getTeamWinTotal();
  });
});

app.factory('TeamFactory', function ($http, $stateParams, $log) {

  var teamTotalWins = 0;

  function getTeams() {

    return $http.get('api/team/' + $stateParams.id + '/nba_teams').then(function (response) {
      teamTotalWins = 0;
      response.data.forEach(function (team) {
        teamTotalWins += team.wins;
      });
      return response.data;
    }).catch($log);
  }

  return {
    getTeams: getTeams,
    getTeamWinTotal: function getTeamWinTotal() {
      return teamTotalWins;
    }
  };
});

app.config(function ($stateProvider) {

  $stateProvider.state('team', {
    url: '/team/:id',
    templateUrl: 'js/views/team/team.html',
    controller: 'TeamCtrl'
  });
});

app.controller('UserCtrl', function ($scope, UserFactory) {

  $scope.tab = { home: 'active' };

  $scope.userTeams = UserFactory.getUserTeams();

  $scope.selectedTeamID = UserFactory.getSelectedTeamID();

  $scope.selectedLeagueID = UserFactory.getSelectedLeagueID();
});

app.factory('UserFactory', function ($http, Session, $log) {

  var userTeams = [];
  var userSelectedTeamID = undefined;
  var userSelectedLeagueID = undefined;

  function initUserFactory() {
    return $http.get('api/team/user/' + Session.user.id).then(function (response) {
      userTeams = response.data;
      // Intialize these to first team and league to start
      userSelectedTeamID = userTeams[0].id;
      userSelectedLeagueID = userTeams[0].league.id;
    }).catch($log);
  }

  return {
    initUserFactory: initUserFactory,
    getUserTeams: function getUserTeams() {
      return userTeams;
    },
    getSelectedTeamID: function getSelectedTeamID() {
      return userSelectedTeamID;
    },
    getSelectedLeagueID: function getSelectedLeagueID() {
      return userSelectedLeagueID;
    }
  };
});

app.config(function ($stateProvider) {

  $stateProvider.state('user', {
    url: '/user',
    templateUrl: 'js/views/user/user.html',
    controller: 'UserCtrl'
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInByZS1idWlsdC9wcmUtYnVpbHQuanMiLCJkaXJlY3RpdmVzL25hdmJhci9uYXZiYXIuanMiLCJkaXJlY3RpdmVzL3RhYk1lbnUvdGFiTWVudS5qcyIsInZpZXdzL2Nvb2tpZXMvY29va2llRmFjdG9yeS5qcyIsInZpZXdzL2xlYWd1ZS9sZWFndWUuY29udHJvbGxlci5qcyIsInZpZXdzL2xlYWd1ZS9sZWFndWUuZmFjdG9yeS5qcyIsInZpZXdzL2xlYWd1ZS9sZWFndWUuc3RhdGUuanMiLCJ2aWV3cy9sb2dpbi9sb2dpbi5zdGF0ZS5qcyIsInZpZXdzL2xvZ2luL2xvZ2luQ29udHJvbGxlci5qcyIsInZpZXdzL2xvZ2luL2xvZ2luRmFjdG9yeS5qcyIsInZpZXdzL25iYS1sZWFndWUvbmJhLmxlYWd1ZS5jb250cm9sbGVyLmpzIiwidmlld3MvbmJhLWxlYWd1ZS9uYmEubGVhZ3VlLmZhY3RvcnkuanMiLCJ2aWV3cy9uYmEtbGVhZ3VlL25iYS5sZWFndWUuc3RhdGUuanMiLCJ2aWV3cy90ZWFtL3RlYW0uY29udHJvbGxlci5qcyIsInZpZXdzL3RlYW0vdGVhbS5mYWN0b3J5LmpzIiwidmlld3MvdGVhbS90ZWFtLnN0YXRlLmpzIiwidmlld3MvdXNlci91c2VyLmNvbnRyb2xsZXIuanMiLCJ2aWV3cy91c2VyL3VzZXIuZmFjdG9yeS5qcyIsInZpZXdzL3VzZXIvdXNlci5zdGF0ZS5qcyJdLCJuYW1lcyI6WyJ3aW5kb3ciLCJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHVybFJvdXRlclByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCJodG1sNU1vZGUiLCJvdGhlcndpc2UiLCJ3aGVuIiwibG9jYXRpb24iLCJyZWxvYWQiLCJydW4iLCIkcm9vdFNjb3BlIiwiJG9uIiwiZXZlbnQiLCJ0b1N0YXRlIiwidG9QYXJhbXMiLCJmcm9tU3RhdGUiLCJmcm9tUGFyYW1zIiwidGhyb3duRXJyb3IiLCJjb25zb2xlIiwiaW5mbyIsIm5hbWUiLCJlcnJvciIsIkF1dGhTZXJ2aWNlIiwiJHN0YXRlIiwiZGVzdGluYXRpb25TdGF0ZVJlcXVpcmVzQXV0aCIsInN0YXRlIiwiZGF0YSIsImF1dGhlbnRpY2F0ZSIsImlzQXV0aGVudGljYXRlZCIsInByZXZlbnREZWZhdWx0IiwiZ2V0TG9nZ2VkSW5Vc2VyIiwidGhlbiIsInVzZXIiLCJnbyIsIkVycm9yIiwiY29uc3RhbnQiLCJsb2dpblN1Y2Nlc3MiLCJsb2dpbkZhaWxlZCIsImxvZ291dFN1Y2Nlc3MiLCJzZXNzaW9uVGltZW91dCIsIm5vdEF1dGhlbnRpY2F0ZWQiLCJub3RBdXRob3JpemVkIiwiZmFjdG9yeSIsIiRxIiwiQVVUSF9FVkVOVFMiLCJzdGF0dXNEaWN0IiwicmVzcG9uc2VFcnJvciIsInJlc3BvbnNlIiwiJGJyb2FkY2FzdCIsInN0YXR1cyIsInJlamVjdCIsIiRodHRwUHJvdmlkZXIiLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwiJGluamVjdG9yIiwiZ2V0Iiwic2VydmljZSIsIiRodHRwIiwiU2Vzc2lvbiIsIm9uU3VjY2Vzc2Z1bExvZ2luIiwiY3JlYXRlIiwiZnJvbVNlcnZlciIsImNhdGNoIiwibG9naW4iLCJjcmVkZW50aWFscyIsInBvc3QiLCJtZXNzYWdlIiwibG9nb3V0IiwiZGVzdHJveSIsInNlbGYiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsInRlbXBsYXRlVXJsIiwiY29va2llT2JqIiwiaXNDb29raWUiLCJkb2N1bWVudCIsImNvb2tpZSIsInBhcnNlVXNlckluZm8iLCJzZXRDb29raWUiLCJsb2dpbkluZm8iLCJlbWFpbCIsInBhc3N3b3JkIiwiSlNPTiIsInN0cmluZ2lmeSIsInJlc2V0Q29va2llRXhwaXJlIiwiY3VycmVudERhdGUiLCJEYXRlIiwiZXhwaXJlRGF0ZSIsInNldE1vbnRoIiwiZ2V0TW9udGgiLCJ0b1VUQ1N0cmluZyIsImdldENvb2tpZSIsInBhcnNlSW5mbyIsInNwbGl0IiwidXNlckluZm8iLCJwYXJzZSIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCJMZWFndWVGYWN0b3J5IiwidGFiIiwibGVhZ3VlIiwiZ2V0TGVhZ3VlVGVhbXMiLCJ0ZWFtcyIsImxlYWd1ZVRlYW1zIiwiJHN0YXRlUGFyYW1zIiwiaWQiLCJsb2ciLCIkc3RhdGVQcm92aWRlciIsInVybCIsIkxvZ2luRmFjdG9yeSIsIkNvb2tpZUZhY3RvcnkiLCJpc0xvZ2luU3RhdGUiLCJzZW5kTG9naW5Ob3ciLCJzZW5kTG9naW4iLCJVc2VyRmFjdG9yeSIsImluaXRVc2VyRmFjdG9yeSIsIk5CQV9MZWFndWVfRmFjdG9yeSIsIm5iYVN0YW5kaW5ncyIsIm5iYVRlYW1zSW5mbyIsImdldE5CQVRlYW1JbmZvIiwiJGxvZyIsIm5iYVRlYW1JbmZvIiwiVGVhbUZhY3RvcnkiLCJ0ZWFtIiwiZ2V0VGVhbXMiLCJuYmFUZWFtcyIsInRlYW1Ub3RhbFdpbnMiLCJnZXRUZWFtV2luVG90YWwiLCJmb3JFYWNoIiwid2lucyIsImhvbWUiLCJ1c2VyVGVhbXMiLCJnZXRVc2VyVGVhbXMiLCJzZWxlY3RlZFRlYW1JRCIsImdldFNlbGVjdGVkVGVhbUlEIiwic2VsZWN0ZWRMZWFndWVJRCIsImdldFNlbGVjdGVkTGVhZ3VlSUQiLCJ1c2VyU2VsZWN0ZWRUZWFtSUQiLCJ1bmRlZmluZWQiLCJ1c2VyU2VsZWN0ZWRMZWFndWVJRCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0FBLE9BQUFDLEdBQUEsR0FBQUMsUUFBQUMsTUFBQSxDQUFBLGdCQUFBLEVBQUEsQ0FBQSxVQUFBLEVBQUEsV0FBQSxDQUFBLENBQUE7O0FBRUFGLElBQUFHLE1BQUEsQ0FBQSxVQUFBQyxrQkFBQSxFQUFBQyxpQkFBQSxFQUFBO0FBQ0E7QUFDQUEsb0JBQUFDLFNBQUEsQ0FBQSxJQUFBO0FBQ0E7QUFDQUYscUJBQUFHLFNBQUEsQ0FBQSxRQUFBO0FBQ0E7QUFDQUgscUJBQUFJLElBQUEsQ0FBQSxpQkFBQSxFQUFBLFlBQUE7QUFDQVQsV0FBQVUsUUFBQSxDQUFBQyxNQUFBO0FBQ0EsR0FGQTtBQUdBLENBVEE7O0FBV0E7QUFDQVYsSUFBQVcsR0FBQSxDQUFBLFVBQUFDLFVBQUEsRUFBQTtBQUNBQSxhQUFBQyxHQUFBLENBQUEsbUJBQUEsRUFBQSxVQUFBQyxLQUFBLEVBQUFDLE9BQUEsRUFBQUMsUUFBQSxFQUFBQyxTQUFBLEVBQUFDLFVBQUEsRUFBQUMsV0FBQSxFQUFBO0FBQ0FDLFlBQUFDLElBQUEsZ0ZBQUFOLFFBQUFPLElBQUE7QUFDQUYsWUFBQUcsS0FBQSxDQUFBSixXQUFBO0FBQ0EsR0FIQTtBQUlBLENBTEE7O0FBT0E7QUFDQW5CLElBQUFXLEdBQUEsQ0FBQSxVQUFBQyxVQUFBLEVBQUFZLFdBQUEsRUFBQUMsTUFBQSxFQUFBOztBQUVBO0FBQ0EsTUFBQUMsK0JBQUEsU0FBQUEsNEJBQUEsQ0FBQUMsS0FBQSxFQUFBO0FBQ0EsV0FBQUEsTUFBQUMsSUFBQSxJQUFBRCxNQUFBQyxJQUFBLENBQUFDLFlBQUE7QUFDQSxHQUZBOztBQUlBO0FBQ0E7QUFDQWpCLGFBQUFDLEdBQUEsQ0FBQSxtQkFBQSxFQUFBLFVBQUFDLEtBQUEsRUFBQUMsT0FBQSxFQUFBQyxRQUFBLEVBQUE7O0FBRUEsUUFBQSxDQUFBVSw2QkFBQVgsT0FBQSxDQUFBLEVBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxRQUFBUyxZQUFBTSxlQUFBLEVBQUEsRUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0FoQixVQUFBaUIsY0FBQTs7QUFFQVAsZ0JBQUFRLGVBQUEsR0FBQUMsSUFBQSxDQUFBLFVBQUFDLElBQUEsRUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQUFBLElBQUEsRUFBQTtBQUNBVCxlQUFBVSxFQUFBLENBQUFwQixRQUFBTyxJQUFBLEVBQUFOLFFBQUE7QUFDQSxPQUZBLE1BRUE7QUFDQVMsZUFBQVUsRUFBQSxDQUFBLE9BQUE7QUFDQTtBQUNBLEtBVEE7QUFXQSxHQTVCQTtBQThCQSxDQXZDQTs7QUN2QkEsYUFBQTs7QUFFQTs7QUFFQTs7QUFDQSxNQUFBLENBQUFwQyxPQUFBRSxPQUFBLEVBQUEsTUFBQSxJQUFBbUMsS0FBQSxDQUFBLHdCQUFBLENBQUE7O0FBRUEsTUFBQXBDLE1BQUFDLFFBQUFDLE1BQUEsQ0FBQSxVQUFBLEVBQUEsRUFBQSxDQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBRixNQUFBcUMsUUFBQSxDQUFBLGFBQUEsRUFBQTtBQUNBQyxrQkFBQSxvQkFEQTtBQUVBQyxpQkFBQSxtQkFGQTtBQUdBQyxtQkFBQSxxQkFIQTtBQUlBQyxvQkFBQSxzQkFKQTtBQUtBQyxzQkFBQSx3QkFMQTtBQU1BQyxtQkFBQTtBQU5BLEdBQUE7O0FBU0EzQyxNQUFBNEMsT0FBQSxDQUFBLGlCQUFBLEVBQUEsVUFBQWhDLFVBQUEsRUFBQWlDLEVBQUEsRUFBQUMsV0FBQSxFQUFBO0FBQ0EsUUFBQUMsYUFBQTtBQUNBLFdBQUFELFlBQUFKLGdCQURBO0FBRUEsV0FBQUksWUFBQUgsYUFGQTtBQUdBLFdBQUFHLFlBQUFMLGNBSEE7QUFJQSxXQUFBSyxZQUFBTDtBQUpBLEtBQUE7QUFNQSxXQUFBO0FBQ0FPLHFCQUFBLHVCQUFBQyxRQUFBLEVBQUE7QUFDQXJDLG1CQUFBc0MsVUFBQSxDQUFBSCxXQUFBRSxTQUFBRSxNQUFBLENBQUEsRUFBQUYsUUFBQTtBQUNBLGVBQUFKLEdBQUFPLE1BQUEsQ0FBQUgsUUFBQSxDQUFBO0FBQ0E7QUFKQSxLQUFBO0FBTUEsR0FiQTs7QUFlQWpELE1BQUFHLE1BQUEsQ0FBQSxVQUFBa0QsYUFBQSxFQUFBO0FBQ0FBLGtCQUFBQyxZQUFBLENBQUFDLElBQUEsQ0FBQSxDQUNBLFdBREEsRUFFQSxVQUFBQyxTQUFBLEVBQUE7QUFDQSxhQUFBQSxVQUFBQyxHQUFBLENBQUEsaUJBQUEsQ0FBQTtBQUNBLEtBSkEsQ0FBQTtBQU1BLEdBUEE7O0FBU0F6RCxNQUFBMEQsT0FBQSxDQUFBLGFBQUEsRUFBQSxVQUFBQyxLQUFBLEVBQUFDLE9BQUEsRUFBQWhELFVBQUEsRUFBQWtDLFdBQUEsRUFBQUQsRUFBQSxFQUFBOztBQUVBLGFBQUFnQixpQkFBQSxDQUFBWixRQUFBLEVBQUE7QUFDQSxVQUFBZixPQUFBZSxTQUFBckIsSUFBQSxDQUFBTSxJQUFBO0FBQ0EwQixjQUFBRSxNQUFBLENBQUE1QixJQUFBO0FBQ0F0QixpQkFBQXNDLFVBQUEsQ0FBQUosWUFBQVIsWUFBQTtBQUNBLGFBQUFKLElBQUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBQUosZUFBQSxHQUFBLFlBQUE7QUFDQSxhQUFBLENBQUEsQ0FBQThCLFFBQUExQixJQUFBO0FBQ0EsS0FGQTs7QUFJQSxTQUFBRixlQUFBLEdBQUEsVUFBQStCLFVBQUEsRUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLFVBQUEsS0FBQWpDLGVBQUEsTUFBQWlDLGVBQUEsSUFBQSxFQUFBO0FBQ0EsZUFBQWxCLEdBQUFyQyxJQUFBLENBQUFvRCxRQUFBMUIsSUFBQSxDQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBQXlCLE1BQUFGLEdBQUEsQ0FBQSxVQUFBLEVBQUF4QixJQUFBLENBQUE0QixpQkFBQSxFQUFBRyxLQUFBLENBQUEsWUFBQTtBQUNBLGVBQUEsSUFBQTtBQUNBLE9BRkEsQ0FBQTtBQUlBLEtBckJBOztBQXVCQSxTQUFBQyxLQUFBLEdBQUEsVUFBQUMsV0FBQSxFQUFBO0FBQ0EsYUFBQVAsTUFBQVEsSUFBQSxDQUFBLFFBQUEsRUFBQUQsV0FBQSxFQUNBakMsSUFEQSxDQUNBNEIsaUJBREEsRUFFQUcsS0FGQSxDQUVBLFlBQUE7QUFDQSxlQUFBbkIsR0FBQU8sTUFBQSxDQUFBLEVBQUFnQixTQUFBLDRCQUFBLEVBQUEsQ0FBQTtBQUNBLE9BSkEsQ0FBQTtBQUtBLEtBTkE7O0FBUUEsU0FBQUMsTUFBQSxHQUFBLFlBQUE7QUFDQSxhQUFBVixNQUFBRixHQUFBLENBQUEsU0FBQSxFQUFBeEIsSUFBQSxDQUFBLFlBQUE7QUFDQTJCLGdCQUFBVSxPQUFBO0FBQ0ExRCxtQkFBQXNDLFVBQUEsQ0FBQUosWUFBQU4sYUFBQTtBQUNBLE9BSEEsQ0FBQTtBQUlBLEtBTEE7QUFPQSxHQXJEQTs7QUF1REF4QyxNQUFBMEQsT0FBQSxDQUFBLFNBQUEsRUFBQSxVQUFBOUMsVUFBQSxFQUFBa0MsV0FBQSxFQUFBOztBQUVBLFFBQUF5QixPQUFBLElBQUE7O0FBRUEzRCxlQUFBQyxHQUFBLENBQUFpQyxZQUFBSixnQkFBQSxFQUFBLFlBQUE7QUFDQTZCLFdBQUFELE9BQUE7QUFDQSxLQUZBOztBQUlBMUQsZUFBQUMsR0FBQSxDQUFBaUMsWUFBQUwsY0FBQSxFQUFBLFlBQUE7QUFDQThCLFdBQUFELE9BQUE7QUFDQSxLQUZBOztBQUlBLFNBQUFwQyxJQUFBLEdBQUEsSUFBQTs7QUFFQSxTQUFBNEIsTUFBQSxHQUFBLFVBQUE1QixJQUFBLEVBQUE7QUFDQSxXQUFBQSxJQUFBLEdBQUFBLElBQUE7QUFDQSxLQUZBOztBQUlBLFNBQUFvQyxPQUFBLEdBQUEsWUFBQTtBQUNBLFdBQUFwQyxJQUFBLEdBQUEsSUFBQTtBQUNBLEtBRkE7QUFJQSxHQXRCQTtBQXdCQSxDQWpJQSxHQUFBOztBQ0FBbEMsSUFBQXdFLFNBQUEsQ0FBQSxRQUFBLEVBQUEsWUFBQTtBQUNBLFNBQUE7QUFDQUMsY0FBQSxHQURBO0FBRUFDLGlCQUFBO0FBRkEsR0FBQTtBQUlBLENBTEE7O0FDQUExRSxJQUFBd0UsU0FBQSxDQUFBLFNBQUEsRUFBQSxZQUFBO0FBQ0EsU0FBQTtBQUNBQyxjQUFBLEdBREE7QUFFQUMsaUJBQUE7QUFGQSxHQUFBO0FBSUEsQ0FMQTs7QUNBQTFFLElBQUE0QyxPQUFBLENBQUEsZUFBQSxFQUFBLFlBQUE7O0FBRUEsTUFBQStCLFlBQUEsRUFBQTs7QUFFQSxXQUFBQyxRQUFBLEdBQUE7QUFDQSxRQUFBQyxTQUFBQyxNQUFBLEVBQUE7QUFDQUM7QUFDQSxhQUFBLElBQUE7QUFDQSxLQUhBLE1BSUE7QUFDQSxhQUFBLEtBQUE7QUFDQTtBQUNBOztBQUVBLFdBQUFDLFNBQUEsQ0FBQUMsU0FBQSxFQUFBO0FBQ0FOLGNBQUFPLEtBQUEsR0FBQUQsVUFBQUMsS0FBQTtBQUNBUCxjQUFBUSxRQUFBLEdBQUFGLFVBQUFFLFFBQUE7QUFDQU4sYUFBQUMsTUFBQSxHQUFBLGtCQUFBTSxLQUFBQyxTQUFBLENBQUFWLFNBQUEsQ0FBQTtBQUNBVztBQUNBOztBQUVBLFdBQUFBLGlCQUFBLEdBQUE7QUFDQSxRQUFBQyxjQUFBLElBQUFDLElBQUEsRUFBQTtBQUNBLFFBQUFDLGFBQUEsSUFBQUQsSUFBQSxDQUFBRCxZQUFBRyxRQUFBLENBQUFILFlBQUFJLFFBQUEsS0FBQSxDQUFBLENBQUEsQ0FBQTtBQUNBZCxhQUFBQyxNQUFBLEdBQUEsYUFBQVcsV0FBQUcsV0FBQSxFQUFBO0FBQ0E7O0FBRUEsV0FBQUMsU0FBQSxHQUFBO0FBQ0EsV0FBQWxCLFNBQUE7QUFDQTs7QUFFQSxXQUFBSSxhQUFBLEdBQUE7QUFDQSxRQUFBZSxZQUFBakIsU0FBQUMsTUFBQSxDQUFBaUIsS0FBQSxDQUFBLEdBQUEsQ0FBQTtBQUNBLFFBQUFDLFdBQUFGLFVBQUEsQ0FBQSxFQUFBQyxLQUFBLENBQUEsR0FBQSxFQUFBLENBQUEsQ0FBQTtBQUNBcEIsZ0JBQUFTLEtBQUFhLEtBQUEsQ0FBQUQsUUFBQSxDQUFBO0FBQ0E7O0FBRUEsU0FBQTtBQUNBcEIsY0FBQUEsUUFEQTtBQUVBSSxlQUFBQSxTQUZBO0FBR0FhLGVBQUFBO0FBSEEsR0FBQTtBQU1BLENBM0NBOztBQ0FBN0YsSUFBQWtHLFVBQUEsQ0FBQSxZQUFBLEVBQUEsVUFBQUMsTUFBQSxFQUFBeEMsS0FBQSxFQUFBeUMsYUFBQSxFQUFBOztBQUVBRCxTQUFBRSxHQUFBLEdBQUEsRUFBQUMsUUFBQSxRQUFBLEVBQUE7O0FBRUFGLGdCQUFBRyxjQUFBLEdBQ0F0RSxJQURBLENBQ0EsdUJBQUE7QUFBQWtFLFdBQUFLLEtBQUEsR0FBQUMsV0FBQTtBQUFBLEdBREE7QUFFQSxDQU5BOztBQ0FBekcsSUFBQTRDLE9BQUEsQ0FBQSxlQUFBLEVBQUEsVUFBQWUsS0FBQSxFQUFBK0MsWUFBQSxFQUFBOztBQUVBLFdBQUFILGNBQUEsR0FBQTtBQUNBLFdBQUE1QyxNQUFBRixHQUFBLENBQUEsaUJBQUFpRCxhQUFBQyxFQUFBLEdBQUEsUUFBQSxFQUNBMUUsSUFEQSxDQUNBLG9CQUFBO0FBQ0FiLGNBQUF3RixHQUFBLENBQUEzRCxTQUFBckIsSUFBQTtBQUNBLGFBQUFxQixTQUFBckIsSUFBQTtBQUNBLEtBSkEsQ0FBQTtBQUtBOztBQUVBLFNBQUE7QUFDQTJFLG9CQUFBQTs7QUFEQSxHQUFBO0FBS0EsQ0FmQTs7QUNBQXZHLElBQUFHLE1BQUEsQ0FBQSxVQUFBMEcsY0FBQSxFQUFBO0FBQ0FBLGlCQUFBbEYsS0FBQSxDQUFBLFFBQUEsRUFBQTtBQUNBbUYsU0FBQSxhQURBO0FBRUFwQyxpQkFBQSw2QkFGQTtBQUdBd0IsZ0JBQUE7QUFIQSxHQUFBO0FBS0EsQ0FOQTs7QUNBQWxHLElBQUFHLE1BQUEsQ0FBQSxVQUFBMEcsY0FBQSxFQUFBOztBQUVBQSxpQkFBQWxGLEtBQUEsQ0FBQSxPQUFBLEVBQUE7QUFDQW1GLFNBQUEsUUFEQTtBQUVBcEMsaUJBQUEsMkJBRkE7QUFHQXdCLGdCQUFBO0FBSEEsR0FBQTtBQUtBLENBUEE7O0FDQUFsRyxJQUFBa0csVUFBQSxDQUFBLFdBQUEsRUFBQSxVQUFBQyxNQUFBLEVBQUFZLFlBQUEsRUFBQUMsYUFBQSxFQUFBO0FBQ0FiLFNBQUFsQyxLQUFBLEdBQUEsRUFBQTtBQUNBa0MsU0FBQTVFLEtBQUEsR0FBQSxJQUFBO0FBQ0E0RSxTQUFBYyxZQUFBLEdBQUEsWUFBQTtBQUFBLFdBQUEsSUFBQTtBQUFBLEdBQUE7O0FBRUEsV0FBQUMsWUFBQSxDQUFBakMsU0FBQSxFQUFBOztBQUVBa0IsV0FBQTVFLEtBQUEsR0FBQSxJQUFBOztBQUVBd0YsaUJBQUFJLFNBQUEsQ0FBQWxDLFNBQUEsRUFDQWpCLEtBREEsQ0FDQSxZQUFBO0FBQUFtQyxhQUFBNUUsS0FBQSxHQUFBLDRCQUFBO0FBQUEsS0FEQTtBQUVBOztBQUVBNEUsU0FBQWdCLFNBQUEsR0FBQUQsWUFBQTs7QUFFQSxNQUFBRixjQUFBcEMsUUFBQSxFQUFBLEVBQUE7QUFDQXNDLGlCQUFBRixjQUFBbkIsU0FBQSxFQUFBO0FBQ0E7QUFFQSxDQW5CQTs7QUNBQTdGLElBQUE0QyxPQUFBLENBQUEsY0FBQSxFQUFBLFVBQUFwQixXQUFBLEVBQUFDLE1BQUEsRUFBQTJGLFdBQUEsRUFBQUosYUFBQSxFQUFBOztBQUVBLFdBQUFHLFNBQUEsQ0FBQWxDLFNBQUEsRUFBQTtBQUNBLFdBQUF6RCxZQUFBeUMsS0FBQSxDQUFBZ0IsU0FBQSxFQUNBaEQsSUFEQSxDQUNBO0FBQUEsYUFBQStFLGNBQUFoQyxTQUFBLENBQUFDLFNBQUEsQ0FBQTtBQUFBLEtBREEsRUFFQWhELElBRkEsQ0FFQTtBQUFBLGFBQUFtRixZQUFBQyxlQUFBLEVBQUE7QUFBQSxLQUZBLEVBR0FwRixJQUhBLENBR0EsWUFBQTtBQUFBUixhQUFBVSxFQUFBLENBQUEsTUFBQTtBQUFBLEtBSEEsQ0FBQTtBQUlBOztBQUVBLFNBQUE7QUFDQWdGLGVBQUFBO0FBREEsR0FBQTtBQUlBLENBYkE7O0FDQUFuSCxJQUFBa0csVUFBQSxDQUFBLFVBQUEsRUFBQSxVQUFBQyxNQUFBLEVBQUFtQixrQkFBQSxFQUFBOztBQUVBbkIsU0FBQUUsR0FBQSxHQUFBLEVBQUFrQixjQUFBLFFBQUEsRUFBQTs7QUFFQXBCLFNBQUFxQixZQUFBLEdBQUFGLG1CQUFBRyxjQUFBO0FBR0EsQ0FQQTs7QUNBQXpILElBQUE0QyxPQUFBLENBQUEsb0JBQUEsRUFBQSxVQUFBZSxLQUFBLEVBQUErRCxJQUFBLEVBQUE7O0FBRUEsTUFBQUMsY0FBQSxFQUFBOztBQUVBO0FBQ0E7QUFDQSxHQUFBLFNBQUFGLGNBQUEsR0FBQTtBQUNBLFdBQUE5RCxNQUFBRixHQUFBLENBQUEseUJBQUEsRUFDQXhCLElBREEsQ0FDQSxvQkFBQTtBQUNBMEYsb0JBQUExRSxTQUFBckIsSUFBQTtBQUNBLEtBSEEsRUFJQW9DLEtBSkEsQ0FJQTBELElBSkEsQ0FBQTtBQUtBLEdBTkE7O0FBUUEsU0FBQTtBQUNBRCxvQkFBQTtBQUFBLGFBQUFFLFdBQUE7QUFBQTtBQURBLEdBQUE7QUFJQSxDQWxCQTs7QUNBQTNILElBQUFHLE1BQUEsQ0FBQSwwQkFBQTtBQUNBMEcsaUJBQUFsRixLQUFBLENBQUEsV0FBQSxFQUFBO0FBQ0FtRixTQUFBLGdCQURBO0FBRUFwQyxpQkFBQSxxQ0FGQTtBQUdBd0IsZ0JBQUE7QUFIQSxHQUFBO0FBS0EsQ0FOQTs7QUNBQWxHLElBQUFrRyxVQUFBLENBQUEsVUFBQSxFQUFBLFVBQUFDLE1BQUEsRUFBQXlCLFdBQUEsRUFBQTtBQUNBekIsU0FBQUUsR0FBQSxHQUFBLEVBQUF3QixNQUFBLFFBQUEsRUFBQTs7QUFFQUQsY0FBQUUsUUFBQSxHQUNBN0YsSUFEQSxDQUNBLGlCQUFBO0FBQ0FrRSxXQUFBNEIsUUFBQSxHQUFBdkIsS0FBQTtBQUNBTCxXQUFBNkIsYUFBQSxHQUFBSixZQUFBSyxlQUFBLEVBQUE7QUFDQSxHQUpBO0FBTUEsQ0FUQTs7QUNBQWpJLElBQUE0QyxPQUFBLENBQUEsYUFBQSxFQUFBLFVBQUFlLEtBQUEsRUFBQStDLFlBQUEsRUFBQWdCLElBQUEsRUFBQTs7QUFFQSxNQUFBTSxnQkFBQSxDQUFBOztBQUVBLFdBQUFGLFFBQUEsR0FBQTs7QUFFQSxXQUFBbkUsTUFBQUYsR0FBQSxDQUFBLGNBQUFpRCxhQUFBQyxFQUFBLEdBQUEsWUFBQSxFQUNBMUUsSUFEQSxDQUNBLG9CQUFBO0FBQ0ErRixzQkFBQSxDQUFBO0FBQ0EvRSxlQUFBckIsSUFBQSxDQUFBc0csT0FBQSxDQUFBLGdCQUFBO0FBQUFGLHlCQUFBSCxLQUFBTSxJQUFBO0FBQUEsT0FBQTtBQUNBLGFBQUFsRixTQUFBckIsSUFBQTtBQUNBLEtBTEEsRUFNQW9DLEtBTkEsQ0FNQTBELElBTkEsQ0FBQTtBQU9BOztBQUVBLFNBQUE7QUFDQUksY0FBQUEsUUFEQTtBQUVBRyxxQkFBQTtBQUFBLGFBQUFELGFBQUE7QUFBQTtBQUZBLEdBQUE7QUFLQSxDQXBCQTs7QUNBQWhJLElBQUFHLE1BQUEsQ0FBQSwwQkFBQTs7QUFFQTBHLGlCQUFBbEYsS0FBQSxDQUFBLE1BQUEsRUFBQTtBQUNBbUYsU0FBQSxXQURBO0FBRUFwQyxpQkFBQSx5QkFGQTtBQUdBd0IsZ0JBQUE7QUFIQSxHQUFBO0FBTUEsQ0FSQTs7QUNBQWxHLElBQUFrRyxVQUFBLENBQUEsVUFBQSxFQUFBLFVBQUFDLE1BQUEsRUFBQWlCLFdBQUEsRUFBQTs7QUFFQWpCLFNBQUFFLEdBQUEsR0FBQSxFQUFBK0IsTUFBQSxRQUFBLEVBQUE7O0FBRUFqQyxTQUFBa0MsU0FBQSxHQUFBakIsWUFBQWtCLFlBQUEsRUFBQTs7QUFFQW5DLFNBQUFvQyxjQUFBLEdBQUFuQixZQUFBb0IsaUJBQUEsRUFBQTs7QUFFQXJDLFNBQUFzQyxnQkFBQSxHQUFBckIsWUFBQXNCLG1CQUFBLEVBQUE7QUFFQSxDQVZBOztBQ0FBMUksSUFBQTRDLE9BQUEsQ0FBQSxhQUFBLEVBQUEsVUFBQWUsS0FBQSxFQUFBQyxPQUFBLEVBQUE4RCxJQUFBLEVBQUE7O0FBRUEsTUFBQVcsWUFBQSxFQUFBO0FBQ0EsTUFBQU0scUJBQUFDLFNBQUE7QUFDQSxNQUFBQyx1QkFBQUQsU0FBQTs7QUFFQSxXQUFBdkIsZUFBQSxHQUFBO0FBQ0EsV0FBQTFELE1BQUFGLEdBQUEsQ0FBQSxtQkFBQUcsUUFBQTFCLElBQUEsQ0FBQXlFLEVBQUEsRUFDQTFFLElBREEsQ0FDQSxvQkFBQTtBQUNBb0csa0JBQUFwRixTQUFBckIsSUFBQTtBQUNBO0FBQ0ErRywyQkFBQU4sVUFBQSxDQUFBLEVBQUExQixFQUFBO0FBQ0FrQyw2QkFBQVIsVUFBQSxDQUFBLEVBQUEvQixNQUFBLENBQUFLLEVBQUE7QUFDQSxLQU5BLEVBT0EzQyxLQVBBLENBT0EwRCxJQVBBLENBQUE7QUFRQTs7QUFFQSxTQUFBO0FBQ0FMLHFCQUFBQSxlQURBO0FBRUFpQixrQkFBQTtBQUFBLGFBQUFELFNBQUE7QUFBQSxLQUZBO0FBR0FHLHVCQUFBO0FBQUEsYUFBQUcsa0JBQUE7QUFBQSxLQUhBO0FBSUFELHlCQUFBO0FBQUEsYUFBQUcsb0JBQUE7QUFBQTtBQUpBLEdBQUE7QUFPQSxDQXhCQTs7QUNBQTdJLElBQUFHLE1BQUEsQ0FBQSxVQUFBMEcsY0FBQSxFQUFBOztBQUVBQSxpQkFBQWxGLEtBQUEsQ0FBQSxNQUFBLEVBQUE7QUFDQW1GLFNBQUEsT0FEQTtBQUVBcEMsaUJBQUEseUJBRkE7QUFHQXdCLGdCQUFBO0FBSEEsR0FBQTtBQU1BLENBUkEiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbndpbmRvdy5hcHAgPSBhbmd1bGFyLm1vZHVsZSgnTkJBX1BpY2tlbV9BcHAnLCBbJ3ByZUJ1aWx0JywgJ3VpLnJvdXRlciddKTtcblxuYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHVybFJvdXRlclByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xuICAgIC8vIFRoaXMgdHVybnMgb2ZmIGhhc2hiYW5nIHVybHMgKC8jYWJvdXQpIGFuZCBjaGFuZ2VzIGl0IHRvIHNvbWV0aGluZyBub3JtYWwgKC9hYm91dClcbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG4gICAgLy8gSWYgd2UgZ28gdG8gYSBVUkwgdGhhdCB1aS1yb3V0ZXIgZG9lc24ndCBoYXZlIHJlZ2lzdGVyZWQsIGdvIHRvIHRoZSBcIi9cIiB1cmwuXG4gICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2xvZ2luJyk7XG4gICAgLy8gVHJpZ2dlciBwYWdlIHJlZnJlc2ggd2hlbiBhY2Nlc3NpbmcgYW4gT0F1dGggcm91dGVcbiAgICAkdXJsUm91dGVyUHJvdmlkZXIud2hlbignL2F1dGgvOnByb3ZpZGVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgfSk7XG59KTtcblxuLy8gVGhpcyBhcHAucnVuIGlzIGZvciBsaXN0ZW5pbmcgdG8gZXJyb3JzIGJyb2FkY2FzdGVkIGJ5IHVpLXJvdXRlciwgdXN1YWxseSBvcmlnaW5hdGluZyBmcm9tIHJlc29sdmVzXG5hcHAucnVuKGZ1bmN0aW9uICgkcm9vdFNjb3BlKSB7XG4gICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZUVycm9yJywgZnVuY3Rpb24gKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcywgZnJvbVN0YXRlLCBmcm9tUGFyYW1zLCB0aHJvd25FcnJvcikge1xuICAgICAgICBjb25zb2xlLmluZm8oYFRoZSBmb2xsb3dpbmcgZXJyb3Igd2FzIHRocm93biBieSB1aS1yb3V0ZXIgd2hpbGUgdHJhbnNpdGlvbmluZyB0byBzdGF0ZSBcIiR7dG9TdGF0ZS5uYW1lfVwiLiBUaGUgb3JpZ2luIG9mIHRoaXMgZXJyb3IgaXMgcHJvYmFibHkgYSByZXNvbHZlIGZ1bmN0aW9uOmApO1xuICAgICAgICBjb25zb2xlLmVycm9yKHRocm93bkVycm9yKTtcbiAgICB9KTtcbn0pO1xuXG4vLyBUaGlzIGFwcC5ydW4gaXMgZm9yIGNvbnRyb2xsaW5nIGFjY2VzcyB0byBzcGVjaWZpYyBzdGF0ZXMuXG5hcHAucnVuKGZ1bmN0aW9uICgkcm9vdFNjb3BlLCBBdXRoU2VydmljZSwgJHN0YXRlKSB7XG5cbiAgICAvLyBUaGUgZ2l2ZW4gc3RhdGUgcmVxdWlyZXMgYW4gYXV0aGVudGljYXRlZCB1c2VyLlxuICAgIHZhciBkZXN0aW5hdGlvblN0YXRlUmVxdWlyZXNBdXRoID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS5kYXRhICYmIHN0YXRlLmRhdGEuYXV0aGVudGljYXRlO1xuICAgIH07XG5cbiAgICAvLyAkc3RhdGVDaGFuZ2VTdGFydCBpcyBhbiBldmVudCBmaXJlZFxuICAgIC8vIHdoZW5ldmVyIHRoZSBwcm9jZXNzIG9mIGNoYW5naW5nIGEgc3RhdGUgYmVnaW5zLlxuICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMpIHtcblxuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uU3RhdGVSZXF1aXJlc0F1dGgodG9TdGF0ZSkpIHtcbiAgICAgICAgICAgIC8vIFRoZSBkZXN0aW5hdGlvbiBzdGF0ZSBkb2VzIG5vdCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXG4gICAgICAgICAgICAvLyBTaG9ydCBjaXJjdWl0IHdpdGggcmV0dXJuLlxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKEF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCgpKSB7XG4gICAgICAgICAgICAvLyBUaGUgdXNlciBpcyBhdXRoZW50aWNhdGVkLlxuICAgICAgICAgICAgLy8gU2hvcnQgY2lyY3VpdCB3aXRoIHJldHVybi5cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENhbmNlbCBuYXZpZ2F0aW5nIHRvIG5ldyBzdGF0ZS5cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBBdXRoU2VydmljZS5nZXRMb2dnZWRJblVzZXIoKS50aGVuKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgICAvLyBJZiBhIHVzZXIgaXMgcmV0cmlldmVkLCB0aGVuIHJlbmF2aWdhdGUgdG8gdGhlIGRlc3RpbmF0aW9uXG4gICAgICAgICAgICAvLyAodGhlIHNlY29uZCB0aW1lLCBBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKSB3aWxsIHdvcmspXG4gICAgICAgICAgICAvLyBvdGhlcndpc2UsIGlmIG5vIHVzZXIgaXMgbG9nZ2VkIGluLCBnbyB0byBcImxvZ2luXCIgc3RhdGUuXG4gICAgICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbyh0b1N0YXRlLm5hbWUsIHRvUGFyYW1zKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgIH0pO1xuXG59KTtcbiIsIihmdW5jdGlvbiAoKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvLyBIb3BlIHlvdSBkaWRuJ3QgZm9yZ2V0IEFuZ3VsYXIhIER1aC1kb3kuXG4gICAgaWYgKCF3aW5kb3cuYW5ndWxhcikgdGhyb3cgbmV3IEVycm9yKCdJIGNhblxcJ3QgZmluZCBBbmd1bGFyIScpO1xuXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdwcmVCdWlsdCcsIFtdKTtcblxuICAgIC8vIGFwcC5mYWN0b3J5KCdTb2NrZXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgLy8gICAgIGlmICghd2luZG93LmlvKSB0aHJvdyBuZXcgRXJyb3IoJ3NvY2tldC5pbyBub3QgZm91bmQhJyk7XG4gICAgLy8gICAgIHJldHVybiB3aW5kb3cuaW8od2luZG93LmxvY2F0aW9uLm9yaWdpbik7XG4gICAgLy8gfSk7XG5cbiAgICAvLyBBVVRIX0VWRU5UUyBpcyB1c2VkIHRocm91Z2hvdXQgb3VyIGFwcCB0b1xuICAgIC8vIGJyb2FkY2FzdCBhbmQgbGlzdGVuIGZyb20gYW5kIHRvIHRoZSAkcm9vdFNjb3BlXG4gICAgLy8gZm9yIGltcG9ydGFudCBldmVudHMgYWJvdXQgYXV0aGVudGljYXRpb24gZmxvdy5cbiAgICBhcHAuY29uc3RhbnQoJ0FVVEhfRVZFTlRTJywge1xuICAgICAgICBsb2dpblN1Y2Nlc3M6ICdhdXRoLWxvZ2luLXN1Y2Nlc3MnLFxuICAgICAgICBsb2dpbkZhaWxlZDogJ2F1dGgtbG9naW4tZmFpbGVkJyxcbiAgICAgICAgbG9nb3V0U3VjY2VzczogJ2F1dGgtbG9nb3V0LXN1Y2Nlc3MnLFxuICAgICAgICBzZXNzaW9uVGltZW91dDogJ2F1dGgtc2Vzc2lvbi10aW1lb3V0JyxcbiAgICAgICAgbm90QXV0aGVudGljYXRlZDogJ2F1dGgtbm90LWF1dGhlbnRpY2F0ZWQnLFxuICAgICAgICBub3RBdXRob3JpemVkOiAnYXV0aC1ub3QtYXV0aG9yaXplZCdcbiAgICB9KTtcblxuICAgIGFwcC5mYWN0b3J5KCdBdXRoSW50ZXJjZXB0b3InLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHEsIEFVVEhfRVZFTlRTKSB7XG4gICAgICAgIHZhciBzdGF0dXNEaWN0ID0ge1xuICAgICAgICAgICAgNDAxOiBBVVRIX0VWRU5UUy5ub3RBdXRoZW50aWNhdGVkLFxuICAgICAgICAgICAgNDAzOiBBVVRIX0VWRU5UUy5ub3RBdXRob3JpemVkLFxuICAgICAgICAgICAgNDE5OiBBVVRIX0VWRU5UUy5zZXNzaW9uVGltZW91dCxcbiAgICAgICAgICAgIDQ0MDogQVVUSF9FVkVOVFMuc2Vzc2lvblRpbWVvdXRcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChzdGF0dXNEaWN0W3Jlc3BvbnNlLnN0YXR1c10sIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlc3BvbnNlKVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xuXG4gICAgYXBwLmNvbmZpZyhmdW5jdGlvbiAoJGh0dHBQcm92aWRlcikge1xuICAgICAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKFtcbiAgICAgICAgICAgICckaW5qZWN0b3InLFxuICAgICAgICAgICAgZnVuY3Rpb24gKCRpbmplY3Rvcikge1xuICAgICAgICAgICAgICAgIHJldHVybiAkaW5qZWN0b3IuZ2V0KCdBdXRoSW50ZXJjZXB0b3InKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgXSk7XG4gICAgfSk7XG5cbiAgICBhcHAuc2VydmljZSgnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsIFNlc3Npb24sICRyb290U2NvcGUsIEFVVEhfRVZFTlRTLCAkcSkge1xuXG4gICAgICAgIGZ1bmN0aW9uIG9uU3VjY2Vzc2Z1bExvZ2luKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB2YXIgdXNlciA9IHJlc3BvbnNlLmRhdGEudXNlcjtcbiAgICAgICAgICAgIFNlc3Npb24uY3JlYXRlKHVzZXIpO1xuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KEFVVEhfRVZFTlRTLmxvZ2luU3VjY2Vzcyk7XG4gICAgICAgICAgICByZXR1cm4gdXNlcjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVzZXMgdGhlIHNlc3Npb24gZmFjdG9yeSB0byBzZWUgaWYgYW5cbiAgICAgICAgLy8gYXV0aGVudGljYXRlZCB1c2VyIGlzIGN1cnJlbnRseSByZWdpc3RlcmVkLlxuICAgICAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAhIVNlc3Npb24udXNlcjtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmdldExvZ2dlZEluVXNlciA9IGZ1bmN0aW9uIChmcm9tU2VydmVyKSB7XG5cbiAgICAgICAgICAgIC8vIElmIGFuIGF1dGhlbnRpY2F0ZWQgc2Vzc2lvbiBleGlzdHMsIHdlXG4gICAgICAgICAgICAvLyByZXR1cm4gdGhlIHVzZXIgYXR0YWNoZWQgdG8gdGhhdCBzZXNzaW9uXG4gICAgICAgICAgICAvLyB3aXRoIGEgcHJvbWlzZS4gVGhpcyBlbnN1cmVzIHRoYXQgd2UgY2FuXG4gICAgICAgICAgICAvLyBhbHdheXMgaW50ZXJmYWNlIHdpdGggdGhpcyBtZXRob2QgYXN5bmNocm9ub3VzbHkuXG5cbiAgICAgICAgICAgIC8vIE9wdGlvbmFsbHksIGlmIHRydWUgaXMgZ2l2ZW4gYXMgdGhlIGZyb21TZXJ2ZXIgcGFyYW1ldGVyLFxuICAgICAgICAgICAgLy8gdGhlbiB0aGlzIGNhY2hlZCB2YWx1ZSB3aWxsIG5vdCBiZSB1c2VkLlxuXG4gICAgICAgICAgICBpZiAodGhpcy5pc0F1dGhlbnRpY2F0ZWQoKSAmJiBmcm9tU2VydmVyICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRxLndoZW4oU2Vzc2lvbi51c2VyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTWFrZSByZXF1ZXN0IEdFVCAvc2Vzc2lvbi5cbiAgICAgICAgICAgIC8vIElmIGl0IHJldHVybnMgYSB1c2VyLCBjYWxsIG9uU3VjY2Vzc2Z1bExvZ2luIHdpdGggdGhlIHJlc3BvbnNlLlxuICAgICAgICAgICAgLy8gSWYgaXQgcmV0dXJucyBhIDQwMSByZXNwb25zZSwgd2UgY2F0Y2ggaXQgYW5kIGluc3RlYWQgcmVzb2x2ZSB0byBudWxsLlxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL3Nlc3Npb24nKS50aGVuKG9uU3VjY2Vzc2Z1bExvZ2luKS5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMubG9naW4gPSBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvbG9naW4nLCBjcmVkZW50aWFscylcbiAgICAgICAgICAgICAgICAudGhlbihvblN1Y2Nlc3NmdWxMb2dpbilcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHsgbWVzc2FnZTogJ0ludmFsaWQgbG9naW4gY3JlZGVudGlhbHMuJyB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9sb2dvdXQnKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBTZXNzaW9uLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoQVVUSF9FVkVOVFMubG9nb3V0U3VjY2Vzcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgIH0pO1xuXG4gICAgYXBwLnNlcnZpY2UoJ1Nlc3Npb24nLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgQVVUSF9FVkVOVFMpIHtcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgJHJvb3RTY29wZS4kb24oQVVUSF9FVkVOVFMubm90QXV0aGVudGljYXRlZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5kZXN0cm95KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKEFVVEhfRVZFTlRTLnNlc3Npb25UaW1lb3V0LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLmRlc3Ryb3koKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51c2VyID0gbnVsbDtcblxuICAgICAgICB0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgICB0aGlzLnVzZXIgPSB1c2VyO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMudXNlciA9IG51bGw7XG4gICAgICAgIH07XG5cbiAgICB9KTtcblxufSgpKTtcbiIsImFwcC5kaXJlY3RpdmUoJ25hdmJhcicsIGZ1bmN0aW9uKCl7XG5cdHJldHVybiB7XG5cdFx0cmVzdHJpY3Q6ICdFJyxcblx0XHR0ZW1wbGF0ZVVybDogJ2pzL2RpcmVjdGl2ZXMvbmF2YmFyL25hdmJhci5odG1sJyxcblx0fVxufSk7XG4iLCJhcHAuZGlyZWN0aXZlKCd0YWJtZW51JywgZnVuY3Rpb24oKXtcblx0cmV0dXJuIHtcblx0XHRyZXN0cmljdDogJ0UnLFxuXHRcdHRlbXBsYXRlVXJsOiAnanMvZGlyZWN0aXZlcy90YWJNZW51L3RhYk1lbnUuaHRtbCcsXG5cdH1cbn0pO1xuIiwiYXBwLmZhY3RvcnkoICdDb29raWVGYWN0b3J5JywgZnVuY3Rpb24oKXtcblxuXHRsZXQgY29va2llT2JqID0ge307XG5cblx0ZnVuY3Rpb24gaXNDb29raWUoKXtcblx0XHRpZiAoIGRvY3VtZW50LmNvb2tpZSApe1xuXHRcdFx0cGFyc2VVc2VySW5mbygpO1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fVxuXG5cdGZ1bmN0aW9uIHNldENvb2tpZShsb2dpbkluZm8pe1xuXHRcdGNvb2tpZU9iai5lbWFpbCA9IGxvZ2luSW5mby5lbWFpbDtcblx0XHRjb29raWVPYmoucGFzc3dvcmQgPSBsb2dpbkluZm8ucGFzc3dvcmQ7XG5cdFx0ZG9jdW1lbnQuY29va2llID0gJ3VzZXJJbmZvSlNPTj0nICsgSlNPTi5zdHJpbmdpZnkoIGNvb2tpZU9iaiApO1xuXHRcdHJlc2V0Q29va2llRXhwaXJlKCk7XG5cdH1cblxuXHRmdW5jdGlvbiByZXNldENvb2tpZUV4cGlyZSgpe1xuXHRcdGxldCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7XG5cdFx0bGV0IGV4cGlyZURhdGUgPSBuZXcgRGF0ZSggY3VycmVudERhdGUuc2V0TW9udGgoIGN1cnJlbnREYXRlLmdldE1vbnRoKCkgKyA2KSk7XG5cdFx0ZG9jdW1lbnQuY29va2llID0gJ2V4cGlyZXM9JyArIGV4cGlyZURhdGUudG9VVENTdHJpbmcoKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGdldENvb2tpZSgpe1xuXHRcdHJldHVybiBjb29raWVPYmo7XG5cdH1cblxuXHRmdW5jdGlvbiBwYXJzZVVzZXJJbmZvKCl7XG5cdFx0bGV0IHBhcnNlSW5mbyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnPScpO1xuXHRcdGxldCB1c2VySW5mbyA9IHBhcnNlSW5mb1sxXS5zcGxpdCgnOycpWzBdO1xuXHRcdGNvb2tpZU9iaiA9IEpTT04ucGFyc2UodXNlckluZm8pO1xuXHR9XG5cblx0cmV0dXJuIHtcblx0XHRpc0Nvb2tpZTogaXNDb29raWUsXG5cdFx0c2V0Q29va2llOiBzZXRDb29raWUsXG5cdFx0Z2V0Q29va2llOiBnZXRDb29raWUsXG5cdH1cblxufSk7XG4iLCJhcHAuY29udHJvbGxlciggJ0xlYWd1ZUN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCBMZWFndWVGYWN0b3J5KXtcblxuXHQkc2NvcGUudGFiID0geyBsZWFndWU6ICdhY3RpdmUnIH1cblxuXHRMZWFndWVGYWN0b3J5LmdldExlYWd1ZVRlYW1zKClcblx0LnRoZW4obGVhZ3VlVGVhbXMgPT4geyAkc2NvcGUudGVhbXMgPSBsZWFndWVUZWFtcyB9KVxufSk7XG4iLCJhcHAuZmFjdG9yeSgnTGVhZ3VlRmFjdG9yeScsIGZ1bmN0aW9uKCRodHRwLCAkc3RhdGVQYXJhbXMpe1xuXG5cdGZ1bmN0aW9uIGdldExlYWd1ZVRlYW1zKCl7XG5cdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9sZWFndWUvJyArICRzdGF0ZVBhcmFtcy5pZCArICcvdGVhbXMnIClcblx0XHQudGhlbiggcmVzcG9uc2UgPT4ge1xuXHRcdFx0Y29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSlcblx0XHRcdHJldHVybiByZXNwb25zZS5kYXRhO1xuXHRcdH0pXG5cdH1cblxuXHRyZXR1cm4ge1xuXHRcdGdldExlYWd1ZVRlYW1zOiBnZXRMZWFndWVUZWFtcyxcblxuXHR9XG5cbn0pO1xuIiwiYXBwLmNvbmZpZyhmdW5jdGlvbigkc3RhdGVQcm92aWRlcil7XG5cdCRzdGF0ZVByb3ZpZGVyLnN0YXRlKCAnbGVhZ3VlJywge1xuXHRcdHVybDogJy9sZWFndWUvOmlkJyxcblx0XHR0ZW1wbGF0ZVVybDogJ2pzL3ZpZXdzL2xlYWd1ZS9sZWFndWUuaHRtbCcsXG5cdFx0Y29udHJvbGxlcjogJ0xlYWd1ZUN0cmwnXG5cdH0pXG59KTtcbiIsImFwcC5jb25maWcoZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIpe1xuXG5cdCRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdsb2dpbicsIHtcblx0XHR1cmw6ICcvbG9naW4nLFxuXHRcdHRlbXBsYXRlVXJsOiAnanMvdmlld3MvbG9naW4vbG9naW4uaHRtbCcsXG5cdFx0Y29udHJvbGxlcjogJ0xvZ2luQ3RybCdcblx0fSlcbn0pO1xuIiwiYXBwLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsIExvZ2luRmFjdG9yeSwgQ29va2llRmFjdG9yeSkge1xuICAgICRzY29wZS5sb2dpbiA9IHt9O1xuICAgICRzY29wZS5lcnJvciA9IG51bGw7XG4gICAgJHNjb3BlLmlzTG9naW5TdGF0ZSA9ICgpID0+IHtyZXR1cm4gdHJ1ZTt9XG5cbiAgICBmdW5jdGlvbiBzZW5kTG9naW5Ob3cobG9naW5JbmZvKXtcblxuICAgICAgICAkc2NvcGUuZXJyb3IgPSBudWxsO1xuXG4gICAgICAgIExvZ2luRmFjdG9yeS5zZW5kTG9naW4obG9naW5JbmZvKVxuICAgICAgICAuY2F0Y2goICgpID0+IHsgJHNjb3BlLmVycm9yID0gJ0ludmFsaWQgbG9naW4gY3JlZGVudGlhbHMuJyB9KVxuICAgIH1cblxuICAgICRzY29wZS5zZW5kTG9naW4gPSBzZW5kTG9naW5Ob3dcblxuICAgIGlmICggQ29va2llRmFjdG9yeS5pc0Nvb2tpZSgpICl7XG5cdFx0c2VuZExvZ2luTm93KCBDb29raWVGYWN0b3J5LmdldENvb2tpZSgpICk7XG4gICAgfVxuXG59KTtcbiIsImFwcC5mYWN0b3J5KCAnTG9naW5GYWN0b3J5JywgZnVuY3Rpb24oIEF1dGhTZXJ2aWNlLCAkc3RhdGUsIFVzZXJGYWN0b3J5LCBDb29raWVGYWN0b3J5ICl7XG5cbiAgICBmdW5jdGlvbiBzZW5kTG9naW4obG9naW5JbmZvKXtcbiAgICAgICAgcmV0dXJuIEF1dGhTZXJ2aWNlLmxvZ2luKGxvZ2luSW5mbylcbiAgICAgICAgLnRoZW4oICgpID0+IENvb2tpZUZhY3Rvcnkuc2V0Q29va2llKGxvZ2luSW5mbykpXG4gICAgICAgIC50aGVuKCAoKSA9PiBVc2VyRmFjdG9yeS5pbml0VXNlckZhY3RvcnkoKSApXG4gICAgICAgIC50aGVuKCAoKSA9PiB7ICRzdGF0ZS5nbygndXNlcicpIH0pXG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2VuZExvZ2luOiBzZW5kTG9naW4sXG4gICAgfVxuXG59KTtcbiIsImFwcC5jb250cm9sbGVyKCAnTkJBX0N0cmwnLCBmdW5jdGlvbiggJHNjb3BlLCBOQkFfTGVhZ3VlX0ZhY3Rvcnkpe1xuXG5cdCRzY29wZS50YWIgPSB7IG5iYVN0YW5kaW5nczogJ2FjdGl2ZScgfVxuXG5cdCRzY29wZS5uYmFUZWFtc0luZm8gPSBOQkFfTGVhZ3VlX0ZhY3RvcnkuZ2V0TkJBVGVhbUluZm87XG5cblxufSk7XG4iLCJhcHAuZmFjdG9yeSgnTkJBX0xlYWd1ZV9GYWN0b3J5JywgZnVuY3Rpb24oJGh0dHAsICRsb2cpe1xuXG5cdGxldCBuYmFUZWFtSW5mbyA9IFtdO1xuXG5cdC8vIEZvciBub3cganVzdCBtYWtpbmcgYW4gSUlGRSB3aWxsIG1ha2UgbW9yZVxuXHQvLyBwZXJmb3JtYW50IGxhdGVyXG5cdChmdW5jdGlvbiBnZXROQkFUZWFtSW5mbygpe1xuXHRcdHJldHVybiAkaHR0cC5nZXQoJ2FwaS9uYmEtdGVhbXMvd2lucy8yMDE2Jylcblx0ICAgIC50aGVuKCByZXNwb25zZSA9PiB7XG5cdFx0XHRuYmFUZWFtSW5mbyA9IHJlc3BvbnNlLmRhdGE7XG5cdCAgICB9KVxuXHQgICAgLmNhdGNoKCRsb2cpXG5cdH0pKClcblxuXHRyZXR1cm4ge1xuXHRcdGdldE5CQVRlYW1JbmZvOiAoKSA9PiBuYmFUZWFtSW5mbyxcblx0fVxuXG59KTtcbiIsImFwcC5jb25maWcoICRzdGF0ZVByb3ZpZGVyID0+IHtcblx0JHN0YXRlUHJvdmlkZXIuc3RhdGUoICduYmFMZWFndWUnLCB7XG5cdFx0dXJsOiAnL25iYS1zdGFuZGluZ3MnLFxuXHRcdHRlbXBsYXRlVXJsOiAnanMvdmlld3MvbmJhLWxlYWd1ZS9uYmEubGVhZ3VlLmh0bWwnLFxuXHRcdGNvbnRyb2xsZXI6ICdOQkFfQ3RybCdcblx0fSlcbn0pXG4iLCJhcHAuY29udHJvbGxlciggJ1RlYW1DdHJsJywgKCRzY29wZSwgVGVhbUZhY3RvcnkpID0+IHtcblx0JHNjb3BlLnRhYiA9IHsgdGVhbTogJ2FjdGl2ZScgfVxuXG5cdCBUZWFtRmFjdG9yeS5nZXRUZWFtcygpXG5cdCAudGhlbiggdGVhbXMgPT4ge1xuXHRcdCRzY29wZS5uYmFUZWFtcyA9IHRlYW1zXG5cdFx0JHNjb3BlLnRlYW1Ub3RhbFdpbnMgPSBUZWFtRmFjdG9yeS5nZXRUZWFtV2luVG90YWwoKTtcblx0IH0pXG5cbn0pO1xuIiwiYXBwLmZhY3RvcnkoICdUZWFtRmFjdG9yeScsICggJGh0dHAsICRzdGF0ZVBhcmFtcywgJGxvZykgPT4ge1xuXG5cdGxldCB0ZWFtVG90YWxXaW5zID0gMDtcblxuXHRmdW5jdGlvbiBnZXRUZWFtcygpe1xuXG5cdFx0cmV0dXJuICRodHRwLmdldCgnYXBpL3RlYW0vJyArICRzdGF0ZVBhcmFtcy5pZCArICcvbmJhX3RlYW1zJylcblx0XHQudGhlbiggcmVzcG9uc2UgPT4ge1xuXHRcdFx0dGVhbVRvdGFsV2lucyA9IDA7XG5cdFx0XHRyZXNwb25zZS5kYXRhLmZvckVhY2goIHRlYW0gPT4geyB0ZWFtVG90YWxXaW5zICs9IHRlYW0ud2lucyB9KVxuXHRcdFx0cmV0dXJuIHJlc3BvbnNlLmRhdGE7XG5cdFx0fSlcblx0XHQuY2F0Y2goJGxvZylcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0Z2V0VGVhbXM6IGdldFRlYW1zLFxuXHRcdGdldFRlYW1XaW5Ub3RhbDogKCkgPT4gdGVhbVRvdGFsV2lucyxcblx0fVxuXG59KTtcbiIsImFwcC5jb25maWcoICRzdGF0ZVByb3ZpZGVyID0+IHtcblxuXHQkc3RhdGVQcm92aWRlci5zdGF0ZSggJ3RlYW0nLCB7XG5cdFx0dXJsOiAnL3RlYW0vOmlkJyxcblx0XHR0ZW1wbGF0ZVVybDogJ2pzL3ZpZXdzL3RlYW0vdGVhbS5odG1sJyxcblx0XHRjb250cm9sbGVyOiAnVGVhbUN0cmwnLFxuXHR9KTtcblxufSk7XG4iLCJhcHAuY29udHJvbGxlcignVXNlckN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJGYWN0b3J5KXtcblxuXHQkc2NvcGUudGFiID0geyBob21lOiAnYWN0aXZlJyB9O1xuXG5cdCRzY29wZS51c2VyVGVhbXMgPSBVc2VyRmFjdG9yeS5nZXRVc2VyVGVhbXMoKTtcblxuXHQkc2NvcGUuc2VsZWN0ZWRUZWFtSUQgPSBVc2VyRmFjdG9yeS5nZXRTZWxlY3RlZFRlYW1JRCgpO1xuXG5cdCRzY29wZS5zZWxlY3RlZExlYWd1ZUlEID0gVXNlckZhY3RvcnkuZ2V0U2VsZWN0ZWRMZWFndWVJRCgpO1xuXG59KTtcbiIsImFwcC5mYWN0b3J5KCAnVXNlckZhY3RvcnknLCBmdW5jdGlvbigkaHR0cCwgU2Vzc2lvbiwgJGxvZyl7XG5cblx0bGV0IHVzZXJUZWFtcyA9IFtdO1xuXHRsZXQgdXNlclNlbGVjdGVkVGVhbUlEID0gdW5kZWZpbmVkO1xuXHRsZXQgdXNlclNlbGVjdGVkTGVhZ3VlSUQgPSB1bmRlZmluZWQ7XG5cblx0ZnVuY3Rpb24gaW5pdFVzZXJGYWN0b3J5KCl7XG5cdFx0cmV0dXJuICRodHRwLmdldCgnYXBpL3RlYW0vdXNlci8nICsgU2Vzc2lvbi51c2VyLmlkIClcblx0XHQudGhlbiggcmVzcG9uc2UgPT4ge1xuXHRcdFx0dXNlclRlYW1zID0gcmVzcG9uc2UuZGF0YTtcblx0XHRcdC8vIEludGlhbGl6ZSB0aGVzZSB0byBmaXJzdCB0ZWFtIGFuZCBsZWFndWUgdG8gc3RhcnRcblx0XHRcdHVzZXJTZWxlY3RlZFRlYW1JRCA9IHVzZXJUZWFtc1swXS5pZDtcblx0XHRcdHVzZXJTZWxlY3RlZExlYWd1ZUlEID0gdXNlclRlYW1zWzBdLmxlYWd1ZS5pZDtcblx0XHR9KVxuXHRcdC5jYXRjaCgkbG9nKVxuXHR9XG5cblx0cmV0dXJuIHtcblx0XHRpbml0VXNlckZhY3Rvcnk6IGluaXRVc2VyRmFjdG9yeSxcblx0XHRnZXRVc2VyVGVhbXM6ICgpID0+IHVzZXJUZWFtcyxcblx0XHRnZXRTZWxlY3RlZFRlYW1JRDogKCkgPT4gdXNlclNlbGVjdGVkVGVhbUlELFxuXHRcdGdldFNlbGVjdGVkTGVhZ3VlSUQ6ICgpID0+IHVzZXJTZWxlY3RlZExlYWd1ZUlELFxuXHR9XG5cbn0pO1xuIiwiYXBwLmNvbmZpZyhmdW5jdGlvbigkc3RhdGVQcm92aWRlcil7XG5cblx0JHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3VzZXInLCB7XG5cdFx0dXJsOiAnL3VzZXInLFxuXHRcdHRlbXBsYXRlVXJsOiAnanMvdmlld3MvdXNlci91c2VyLmh0bWwnLFxuXHRcdGNvbnRyb2xsZXI6ICdVc2VyQ3RybCdcblx0fSlcblxufSk7XG4iXX0=
